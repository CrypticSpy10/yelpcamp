<% layout('layouts/boilerplate') %>
  <div id="cluster-map" class="mapbox-container"></div>

  <h1>ALL CAMPGROUNDS</h1>
  <div class="mb-3">
    <a class="btn btn-primary" href="/campgrounds/new">Add New Campground</a>
  </div>

  <% for (let campground of campgrounds) { %>
    <div class="card mb-3">
      <div class="row">
        <div class="col-md-3">
          <% if (campground.images.length) { %>
            <img class="img-fluid" alt="" src="<%= campground.images[0].url %>">
            <% } else { %>
              <img crossorigin="anonymous" class="img-fluid" alt="No image available"
                src="https://res.cloudinary.com/demo/image/upload/sample.jpg">
              <% } %>
        </div>
        <div class="col-md-8">
          <div class="card-body">
            <h5 class="card-title">
              <%= campground.title %>
            </h5>
            <p class="card-text">
              <%= campground.description %>
            </p>
            <p class="card-text">
              <small class="text-muted">
                <%= campground.location %>
              </small>
            </p>
            <a class="btn btn-primary" href="/campgrounds/<%= campground._id %>">
              View <%= campground.title %>
            </a>


          </div>
        </div>
      </div>
    </div>
    <% } %>


      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center mt-4">

          <!-- Previous Button -->
          <% if (currentPage> 1) { %>
            <li class="page-item">
              <a class="page-link" href="?page=<%= currentPage - 1 %>">&laquo;</a>
            </li>
            <% } else { %>
              <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
              <% } %>

                <!-- Always show first page -->
                <li class="page-item <%= currentPage === 1 ? 'active' : '' %>">
                  <a class="page-link" href="?page=1">1</a>
                </li>

                <!-- Left ellipsis -->
                <% if (currentPage> 3) { %>
                  <li class="page-item disabled"><span class="page-link">...</span></li>
                  <% } %>

                    <!-- Pages around current -->
                    <% let start=Math.max(2, currentPage - 1); let end=Math.min(totalPages - 1, currentPage + 1); for
                      (let i=start; i <=end; i++) { %>
                      <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                        <a class="page-link" href="?page=<%= i %>">
                          <%= i %>
                        </a>
                      </li>
                      <% } %>

                        <!-- Right ellipsis -->
                        <% if (currentPage < totalPages - 2) { %>
                          <li class="page-item disabled"><span class="page-link">...</span></li>
                          <% } %>

                            <!-- Always show last page -->
                            <% if (totalPages> 1) { %>
                              <li class="page-item <%= currentPage === totalPages ? 'active' : '' %>">
                                <a class="page-link" href="?page=<%= totalPages %>">
                                  <%= totalPages %>
                                </a>
                              </li>
                              <% } %>

                                <!-- Next Button -->
                                <% if (currentPage < totalPages) { %>
                                  <li class="page-item">
                                    <a class="page-link" href="?page=<%= currentPage + 1 %>">&raquo;</a>
                                  </li>
                                  <% } else { %>
                                    <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
                                    <% } %>

        </ul>
      </nav>


      <script>
        const mapToken = '<%- process.env.MAPBOX_TOKEN %>';
        const allCampgrounds = <%- JSON.stringify(allCampgrounds) %>;   // If you format this document in VS Code, it breaks this line
      </script>
      <script src="/javascripts/clusterMap.js"></script>